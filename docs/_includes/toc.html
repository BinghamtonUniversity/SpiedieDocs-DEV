{%- assign sorted_pages = site.pages 
    | where_exp: "p", "p.extname == '.md' and p.path contains '/docs/docs/' and p.nav_exclude != true"
    | sort: "nav_order"
-%}

{%- assign folder_groups = "" -%}
{%- for page in sorted_pages %}
  {%- assign parent_title = page.parent | default: page.dir | split: "/" | last | replace: "-", " " | capitalize -%}
  {%- assign folder_groups = folder_groups | append: parent_title | append: "|" -%}
{%- endfor -%}

{%- assign section_names = folder_groups | split: "|" | uniq | sort -%}

<ol class="toc-l1">
  {%- for section in section_names %}
    <li class="toc-item toc-l1-item">
      <h3 class="toc-l1-title">{{ section }}</h3>
      <ol class="sub-toc toc-l2">
        {%- for page in sorted_pages %}
          {%- assign parent_title = page.parent | default: page.dir | split: "/" | last | replace: "-", " " | capitalize -%}
          {%- if parent_title == section -%}
            <li class="toc-item toc-l2-item">
              <a class="toc-link toc-l2-link {% if page.url == page.url %}active{% endif %}" href="{{ page.url | relative_url }}">
                {{ page.title }}
              </a>
            </li>
          {%- endif -%}
        {%- endfor %}
      </ol>
    </li>
  {%- endfor %}
</ol>
