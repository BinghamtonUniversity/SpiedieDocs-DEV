<!DOCTYPE html>
 
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MPI on Spiedie (advanced) | Spiedie | Binghamton University</title>
    <link rel="shortcut icon" href="http://localhost:4000/assets/images/favicon.ico" />

    <link rel="stylesheet" href="http://localhost:4000/assets/css/pygments.css" />
    <link rel="stylesheet" href="http://localhost:4000/assets/css/bingfont.css" />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.8.2/css/all.css"
      integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="http://localhost:4000/assets/css/default.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com"> 
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
<link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,400;1,500;1,600;1,700;1,800&display=swap" rel="stylesheet">
    <!-- <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/default.min.css"> -->
    <!--<script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-11743206-2');
    </script>-->
  </head>
  <body>
    <div class="page-container">
      <nav class="navbar">
        <div class="navbar-container">
          <a class="navbar-brand" href="http://localhost:4000"
            ><i class="bu bu-b" style="font-size: 24px"></i>&nbsp;&nbsp; Spiedie
            Docs</a
          >
          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarColor01"
            aria-controls="navbarColor01"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <ul class="navbar-menu">
            <li class="navbar-item">
              <a class="navbar-link" href="http://localhost:4000/docs">Docs</a>
            </li>
            <li class="navbar-item">
              <a class="navbar-link" href="http://localhost:4000/singularity"
                >Singularity</a
              >
            </li>
            <!-- <li class="navbar-item dropdown">
              <a
                class="navbar-link dropdown-toggle"
                href="http://localhost:4000/tutorials"
                id="navbarDropdownMenuLink"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <i class="fa fa-tags"></i>&nbsp; Tutorials
              </a>
              <div
              class="dropdown-menu"
              aria-labelledby="navbarDropdownMenuLink"
              style="height: auto; max-height: 400px; overflow-x: hidden"
            >
                                 
              <a class="dropdown-item" href="http://localhost:4000/tutorials/"
                >Tutorials</a
              >
                            
              <a class="dropdown-item" href="http://localhost:4000/tutorials/quick_start.html"
                >Quick Start Tutorial - Python</a
              >
                    
              <a class="dropdown-item" href="http://localhost:4000/tutorials/spiedie_MPI.html"
                >MPI on Spiedie (advanced)</a
              >
                  
              <a class="dropdown-item" href="http://localhost:4000/tutorials/spiedie_conda.html"
                >Conda on Spiedie (intermediate)</a
              >
                
              <a class="dropdown-item" href="http://localhost:4000/tutorials/spiedie_gpu_compute.html"
                >GPU on Spiedie (advanced)</a
              >
                    
              <a class="dropdown-item" href="http://localhost:4000/tutorials/spiedie_multiprocessing.html"
                >Python Multi-Core Tutorial</a
              >
                
              <a class="dropdown-item" href="http://localhost:4000/tutorials/spiedie_openmp_multi_core.html"
                >OpenMP on Spiedie (advanced)</a
              >
                  
              <a class="dropdown-item" href="http://localhost:4000/tutorials/spiedie_singularity.html"
                >Singularity Containers on Spiedie (advanced)</a
              >
                                   
            </div>
            </li>
            <li class="navbar-item dropdown">
              <a
                class="navbar-link dropdown-toggle"
                href="#"
                id="navbarDropdownMenuLink"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <i class="fa fa-tags"></i>&nbsp; Tags
              </a>
              <div
              class="dropdown-menu"
              aria-labelledby="navbarDropdownMenuLink"
              style="height: auto; max-height: 400px; overflow-x: hidden"
            >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#blas"
                >BLAS</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#clang"
                >CLANG</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#cmake"
                >CMAKE</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#cublas"
                >CUBLAS</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#cuda"
                >CUDA</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#check-job-status"
                >Check Job Status</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#cloud-storage"
                >Cloud Storage</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#conda"
                >Conda</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#configuration"
                >Configuration</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#containers"
                >Containers</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#create-images"
                >Create Images</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#faq"
                >FAQ</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#file-transfer"
                >File Transfer</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#forwarding"
                >Forwarding</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#gcc"
                >GCC</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#gemm"
                >GEMM</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#gpu"
                >GPU</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#gpucompute"
                >GPUCompute</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#gui"
                >GUI</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#icc"
                >ICC</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#intel-compilers"
                >Intel Compilers</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#interactive-sessions"
                >Interactive Sessions</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#job-submission"
                >Job Submission</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#linux"
                >Linux</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#login"
                >Login</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#matlab"
                >MATLAB</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#mvapich2"
                >MVAPICH2</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#mac"
                >Mac</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#modules"
                >Modules</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#multiprocessing"
                >Multiprocessing</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#new-user"
                >New_User</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#python"
                >Python</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#python-program"
                >Python Program</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#remote-access"
                >Remote Access</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#remote-build"
                >Remote Build</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#run-program"
                >Run Program</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#sbatch"
                >SBATCH</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#slurm"
                >SLURM</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#srun"
                >SRUN</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#setup"
                >Setup</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#singularity"
                >Singularity</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#submit-job"
                >Submit Job</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#submit-job"
                >Submit job</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#sylabs-cloud-services"
                >Sylabs Cloud Services</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#tensorflow"
                >Tensorflow</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#tensorflow-gpu"
                >Tensorflow-GPU</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#tutorial"
                >Tutorial</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#windows"
                >Windows</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#workflow"
                >Workflow</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#x11"
                >X11</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#containers"
                >containers</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#create-image"
                >create image</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#custom-container"
                >custom container</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#docs"
                >docs</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#features"
                >features</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#interactive-session"
                >interactive session</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#memory-allocation"
                >memory allocation</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#memory-management"
                >memory management</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#modules"
                >modules</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#mpi"
                >mpi</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#multicore"
                >multicore</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#multinode"
                >multinode</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#partitions"
                >partitions</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#sacct"
                >sacct</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#sbatch"
                >sbatch</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#sinfo"
                >sinfo</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#singularity"
                >singularity</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#singularity-definition-files"
                >singularity definition files</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#singularity-exec"
                >singularity exec</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#singularity-recipes"
                >singularity recipes</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#singularity-run"
                >singularity run</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#srun"
                >srun</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#tutorial"
                >tutorial</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#tutorials"
                >tutorials</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#virtual-environment"
                >virtual environment</a
              >
              
              <a
                class="dropdown-item"
                href="http://localhost:4000/tags#x2go"
                >x2go</a
              >
              
            </div>
            </li>-->
          </ul>
          <!--<form class="form-inline">
          <input
            class="form-control mr-sm-2 docs_search"
            type="search"
            placeholder="Search Docs"
            aria-label="Search Documentation"
          />
        </form>-->
        </div>
      </nav>

      <main>
        <aside class="sidebar">
          <div class="sidebar-container">
            <div class="sidebar-close">
              <button class="sidebar-close-button">
                <i class="fa fa-times"></i>
              </button>
            </div>
            <div class="sidebar-search">
              <form class="search-bar">
                <input
                  type="text"
                  class="form-control docs_search"
                  placeholder="Search Docs"
                />
              </form>
            </div>
            <div class="sidebar-menu no-scroll-bar">
              
                <ol class="toc-l1"><li class="toc-item toc-l1-item">
                      <h3 class="toc-l1-title">Introduction to Spiedie</h3>
                      
                        <ol class="sub-toc toc-l2"><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/introduction.html" target=>What ia a Cluster</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000https://www.binghamton.edu/watson/facilities/computing/high-performance.html" target=_blank>What is Spiedie</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000https://www.binghamton.edu/watson/facilities/computing/high-performance.html" target=_blank>How do I get an account</a>
                              
                                
                              
                            </li></ol>
                      
                    </li><li class="toc-item toc-l1-item">
                      <h3 class="toc-l1-title">How To Use Spiedie</h3>
                      
                        <ol class="sub-toc toc-l2"><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/login.html" target=>Logging In</a>
                              
                                
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/data_transfer.html" target=>Transferring Data</a>
                              
                                
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/basic_linux_commands.html" target=>Basic Linux Commands</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/basic_slurm_commands.html" target=>Basic SLURM Commands</a>
                              
                                
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/spiedie_modules.html" target=>Spiedie Modules</a>
                              
                                
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/spiedie_partitions.html" target=>Spiedie Partitions and Features</a>
                              
                                
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/compilers.html" target=>Compiling Code On Spiedie</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/submitting_jobs.html" target=>Running Jobs</a>
                              
                                
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/spiedie_conda.html" target=>Using Conda on Spiedie</a>
                              
                                
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/x_11_forwarding.html" target=>X11 Fowarding</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/spiedie_matlab.html" target=>MATLAB on Spiedie</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/docs/spiedie_ansys.html" target=>ANSYS on Spiedie</a>
                              
                            </li></ol>
                      
                    </li><li class="toc-item toc-l1-item">
                      <h3 class="toc-l1-title">Tutorials</h3>
                      
                        <ol class="sub-toc toc-l2"><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/tutorials/quick_start.html" target=>Quick Start (Python)</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/tutorials/spiedie_multiprocessing.html" target=>Multi-core Program (Python)</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/tutorials/spiedie_openmpi_multi_core.html" target=>Multi-core (C++/OpenMPI)</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/tutorials/spiedie_gpu_compute.html" target=>GPU Compute (CUDA)</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/tutorials/spiedie_MPI.html" target=>Multi-node Multi-core Program (MPI)</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/tutorials/singularity.html" target=>Using Containers (Singularity)</a>
                              
                            </li><li class=" toc-item toc-l2-item">
                              <a class="toc-link toc-l2-link" href="http://localhost:4000/tutorials/conda.html" target=>Using Conda (Python)</a>
                              
                            </li></ol>
                      
                    </li></ol>
              
            </div>
          </div>
        </aside>
        <div class="content-container">
          <div class="sidebar-show">
            <button class="sidebar-show-button">
              <i class="fas fa-bars"></i>
            </button>
          </div>
          <section class="main-content no-scroll-bar">
            <h1>
               MPI on Spiedie (advanced) 
            </h1>
            
            <article >
              <hr />

<p>One of the advantages of Spiedie is the high performing computing hardware available for each user. In this tutorial, we will be running an MPI Hello World program on Spiedie.</p>

<p>Covered in this guide:</p>

<ol>
  <li><a href="#mpi_run">Compiling a MPI program</a></li>
  <li><a href="#mpi_sbatch">Run script for MPI</a></li>
</ol>

<hr />
<h2 id="-compiling-a-mpi-program"><a name="mpi_run"></a> Compiling a MPI Program</h2>

<p>Massage Passing Interface (MPI) is a standardized massage-passing standard used for high performance parallel computing on a distributed network. Spiedie supports the following standards implementations:</p>
<ol>
  <li>MPICH</li>
  <li>MVAPICH(2)</li>
  <li>OPENMPI</li>
</ol>

<p>We will be using mvapich2 implementation of MPI. We will be using the MPI Hello World Example from Wes Kendall <a href="https://mpitutorial.com/tutorials/mpi-hello-world/" target="_blank"> from here</a>.</p>

<p>You can download the <a href="code/mpi.c" download=""> code from here.</a></p>

<p>mpi.c:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;mpi.h&gt;
#include &lt;stdio.h&gt;
</span>
<span class="cp">#include &lt;mpi.h&gt;
#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Initialize the MPI environment</span>
    <span class="n">MPI_Init</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">// Get the number of processes</span>
    <span class="kt">int</span> <span class="n">world_size</span><span class="p">;</span>
    <span class="n">MPI_Comm_size</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">world_size</span><span class="p">);</span>

    <span class="c1">// Get the rank of the process</span>
    <span class="kt">int</span> <span class="n">world_rank</span><span class="p">;</span>
    <span class="n">MPI_Comm_rank</span><span class="p">(</span><span class="n">MPI_COMM_WORLD</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">world_rank</span><span class="p">);</span>

    <span class="c1">// Get the name of the processor</span>
    <span class="kt">char</span> <span class="n">processor_name</span><span class="p">[</span><span class="n">MPI_MAX_PROCESSOR_NAME</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">name_len</span><span class="p">;</span>
    <span class="n">MPI_Get_processor_name</span><span class="p">(</span><span class="n">processor_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">name_len</span><span class="p">);</span>

    <span class="c1">// Print off a hello world message</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Hello world from processor %s, rank %d out of %d processors</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span>
           <span class="n">processor_name</span><span class="p">,</span> <span class="n">world_rank</span><span class="p">,</span> <span class="n">world_size</span><span class="p">);</span>

    <span class="c1">// Finalize the MPI environment.</span>
    <span class="n">MPI_Finalize</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The code will print out the name of the compute node, and the rank of the processor.</p>

<p>We will need the MPI-wrapper for gcc in order to compile the code.</p>

<h2 id="-run-script-for-mpi"><a name="mpi_sbatch"></a> Run script for MPI</h2>

<h4 id="preliminaries">Preliminaries</h4>
<p>We can create a run script called, <code class="language-plaintext highlighter-rouge">mpi_run.sh</code>.</p>

<p>We have to add the shebang at the beginning of the run script. It is aslo good practice to name our job so we can add:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c">#</span>
<span class="c">#SBATCH --job-name=MPI_TEST</span>
</code></pre></div></div>

<p>We can pipe our output to a log file with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#SBATCH --output=mpi_out.log</span>
</code></pre></div></div>

<h4 id="resource-allocation">Resource Allocation</h4>

<p>We will be asking for multiple nodes in our test program with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#SBATCH -N 2</span>
</code></pre></div></div>

<p>This asks for 2 compute nodes which will allow us to fully take advantage of the multiple node infrastructure.</p>

<p>We will also run the program on the quick partition with;</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#SBATCH --partition=quick</span>
</code></pre></div></div>

<h4 id="running-the-program">Running the Program</h4>

<p>We must add the MPI library with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module load mvapich2/gcc/64/2.3b
</code></pre></div></div>

<p>To then compile the program:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mpicc <span class="nt">-o</span> mpi_test mpi.c 
</code></pre></div></div>

<p>Since MVAPICH2 is built with Slurm support on Spiedie, it is best practice to let slurm spin up the processes on the multiple nodes, and so we will use srun to run our program.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>srun ./mpi_test
</code></pre></div></div>

<p>The final run script can be downloaded &lt;a href=”code/mpi_run.sh” download=&gt; here&lt;/a&gt; :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c">#</span>
<span class="c">#SBATCH --job-name=MPI_TEST</span>
<span class="c">#SBATCH --output=mpi_out.log</span>
<span class="c">#</span>
<span class="c">#SBATCH -N 2</span>
<span class="c">#SBATCH --partition=quick</span>
<span class="c">#</span>

module load mvapich2/gcc/64/2.3b

mpicc <span class="nt">-o</span> mpi_test mpi.c

srun ./mpi_test 
</code></pre></div></div>

<p>We can simply run the job with:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sbatch mpi_run.sh
</code></pre></div></div>

<p>This should submit the job on Spiedie, and once finished create a log file,  <code class="language-plaintext highlighter-rouge">mpi_out.log</code></p>

<p>We can quickly check the output by running:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat </span>mpi_out.log
</code></pre></div></div>

<p>We expect an output such as,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Hello world from processor compute030, rank 0 out of 1 processors
Hello world from processor compute031, rank 0 out of 1 processors
</code></pre></div></div>



              <!-- Small Screen Images -->
              <div class="row">
                <div class="col-sm-12 d-md-block d-lg-none">
                  
                </div>
              </div>
              <!-- End Small Screen Images -->

              
            </article>
          </section>
          <section class="content-detail">
            <!-- Begin Tags -->
            <div class="content-tags-container">
              
                <h3 class="content-tags-title">Tags</h3>
                <ul class="content-tags-list">
                  
                    <li class="content-tag">
                      <a class="content-tag-link" href="http://localhost:4000/tags#tutorial">
                        tutorial
                      </a>
                    </li>
                  
                    <li class="content-tag">
                      <a class="content-tag-link" href="http://localhost:4000/tags#mpi">
                        mpi
                      </a>
                    </li>
                  
                    <li class="content-tag">
                      <a class="content-tag-link" href="http://localhost:4000/tags#multinode">
                        multinode
                      </a>
                    </li>
                  
                    <li class="content-tag">
                      <a class="content-tag-link" href="http://localhost:4000/tags#mvapich2">
                        MVAPICH2
                      </a>
                    </li>
                  
                    <li class="content-tag">
                      <a class="content-tag-link" href="http://localhost:4000/tags#sbatch">
                        SBATCH
                      </a>
                    </li>
                  
                </ul>
              
              </div>
            </div>
            <!-- End Tags -->
          </section>
        </div>
      </main>
      <footer class="row">
        <div class="col-sm-12">
          <!-- Footer -->
        </div>
      </footer>
    </div>
    <script
      src="https://code.jquery.com/jquery-2.2.4.min.js"
      integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <script src="http://localhost:4000/assets/js/jquery.autocomplete.js"></script>
    <!-- <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script> -->
    <script>
      var docs_arr = [
      {
        "url":`/tutorials/`,
        "value": `Tutorials` 
      },{
        "url":`/tutorials/quick_start.html`,
        "value": `Quick Start Tutorial - Python` 
      },{
        "url":`/tutorials/spiedie_MPI.html`,
        "value": `MPI on Spiedie (advanced)` 
      },{
        "url":`/tutorials/spiedie_conda.html`,
        "value": `Conda on Spiedie (intermediate)` 
      },{
        "url":`/tutorials/spiedie_gpu_compute.html`,
        "value": `GPU on Spiedie (advanced)` 
      },{
        "url":`/tutorials/spiedie_multiprocessing.html`,
        "value": `Python Multi-Core Tutorial` 
      },{
        "url":`/tutorials/spiedie_openmp_multi_core.html`,
        "value": `OpenMP on Spiedie (advanced)` 
      },{
        "url":`/tutorials/spiedie_singularity.html`,
        "value": `Singularity Containers on Spiedie (advanced)` 
      },
      {
        "url":`/tags#blas`,
        "value":`BLAS`
      },{
        "url":`/tags#clang`,
        "value":`CLANG`
      },{
        "url":`/tags#cmake`,
        "value":`CMAKE`
      },{
        "url":`/tags#cublas`,
        "value":`CUBLAS`
      },{
        "url":`/tags#cuda`,
        "value":`CUDA`
      },{
        "url":`/tags#check-job-status`,
        "value":`Check Job Status`
      },{
        "url":`/tags#cloud-storage`,
        "value":`Cloud Storage`
      },{
        "url":`/tags#conda`,
        "value":`Conda`
      },{
        "url":`/tags#configuration`,
        "value":`Configuration`
      },{
        "url":`/tags#containers`,
        "value":`Containers`
      },{
        "url":`/tags#create-images`,
        "value":`Create Images`
      },{
        "url":`/tags#faq`,
        "value":`FAQ`
      },{
        "url":`/tags#file-transfer`,
        "value":`File Transfer`
      },{
        "url":`/tags#forwarding`,
        "value":`Forwarding`
      },{
        "url":`/tags#gcc`,
        "value":`GCC`
      },{
        "url":`/tags#gemm`,
        "value":`GEMM`
      },{
        "url":`/tags#gpu`,
        "value":`GPU`
      },{
        "url":`/tags#gpucompute`,
        "value":`GPUCompute`
      },{
        "url":`/tags#gui`,
        "value":`GUI`
      },{
        "url":`/tags#icc`,
        "value":`ICC`
      },{
        "url":`/tags#intel-compilers`,
        "value":`Intel Compilers`
      },{
        "url":`/tags#interactive-sessions`,
        "value":`Interactive Sessions`
      },{
        "url":`/tags#job-submission`,
        "value":`Job Submission`
      },{
        "url":`/tags#linux`,
        "value":`Linux`
      },{
        "url":`/tags#login`,
        "value":`Login`
      },{
        "url":`/tags#matlab`,
        "value":`MATLAB`
      },{
        "url":`/tags#mvapich2`,
        "value":`MVAPICH2`
      },{
        "url":`/tags#mac`,
        "value":`Mac`
      },{
        "url":`/tags#modules`,
        "value":`Modules`
      },{
        "url":`/tags#multiprocessing`,
        "value":`Multiprocessing`
      },{
        "url":`/tags#new-user`,
        "value":`New_User`
      },{
        "url":`/tags#python`,
        "value":`Python`
      },{
        "url":`/tags#python-program`,
        "value":`Python Program`
      },{
        "url":`/tags#remote-access`,
        "value":`Remote Access`
      },{
        "url":`/tags#remote-build`,
        "value":`Remote Build`
      },{
        "url":`/tags#run-program`,
        "value":`Run Program`
      },{
        "url":`/tags#sbatch`,
        "value":`SBATCH`
      },{
        "url":`/tags#slurm`,
        "value":`SLURM`
      },{
        "url":`/tags#srun`,
        "value":`SRUN`
      },{
        "url":`/tags#setup`,
        "value":`Setup`
      },{
        "url":`/tags#singularity`,
        "value":`Singularity`
      },{
        "url":`/tags#submit-job`,
        "value":`Submit Job`
      },{
        "url":`/tags#submit-job`,
        "value":`Submit job`
      },{
        "url":`/tags#sylabs-cloud-services`,
        "value":`Sylabs Cloud Services`
      },{
        "url":`/tags#tensorflow`,
        "value":`Tensorflow`
      },{
        "url":`/tags#tensorflow-gpu`,
        "value":`Tensorflow-GPU`
      },{
        "url":`/tags#tutorial`,
        "value":`Tutorial`
      },{
        "url":`/tags#windows`,
        "value":`Windows`
      },{
        "url":`/tags#workflow`,
        "value":`Workflow`
      },{
        "url":`/tags#x11`,
        "value":`X11`
      },{
        "url":`/tags#containers`,
        "value":`containers`
      },{
        "url":`/tags#create-image`,
        "value":`create image`
      },{
        "url":`/tags#custom-container`,
        "value":`custom container`
      },{
        "url":`/tags#docs`,
        "value":`docs`
      },{
        "url":`/tags#features`,
        "value":`features`
      },{
        "url":`/tags#interactive-session`,
        "value":`interactive session`
      },{
        "url":`/tags#memory-allocation`,
        "value":`memory allocation`
      },{
        "url":`/tags#memory-management`,
        "value":`memory management`
      },{
        "url":`/tags#modules`,
        "value":`modules`
      },{
        "url":`/tags#mpi`,
        "value":`mpi`
      },{
        "url":`/tags#multicore`,
        "value":`multicore`
      },{
        "url":`/tags#multinode`,
        "value":`multinode`
      },{
        "url":`/tags#partitions`,
        "value":`partitions`
      },{
        "url":`/tags#sacct`,
        "value":`sacct`
      },{
        "url":`/tags#sbatch`,
        "value":`sbatch`
      },{
        "url":`/tags#sinfo`,
        "value":`sinfo`
      },{
        "url":`/tags#singularity`,
        "value":`singularity`
      },{
        "url":`/tags#singularity-definition-files`,
        "value":`singularity definition files`
      },{
        "url":`/tags#singularity-exec`,
        "value":`singularity exec`
      },{
        "url":`/tags#singularity-recipes`,
        "value":`singularity recipes`
      },{
        "url":`/tags#singularity-run`,
        "value":`singularity run`
      },{
        "url":`/tags#srun`,
        "value":`srun`
      },{
        "url":`/tags#tutorial`,
        "value":`tutorial`
      },{
        "url":`/tags#tutorials`,
        "value":`tutorials`
      },{
        "url":`/tags#virtual-environment`,
        "value":`virtual environment`
      },{
        "url":`/tags#x2go`,
        "value":`x2go`
      },
      ];
      $('.docs_search').autocomplete({
          lookup: docs_arr,
          onSelect: function (suggestion) {
              window.location = "http://localhost:4000"+suggestion.url
          }
      });
    </script>
  </body>
</html>
